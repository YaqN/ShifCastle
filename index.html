<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Castle Birthday Hall – 3D</title>
  <!-- Fonts for 80s/medieval vibe -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Cinzel:wght@400;700&family=VT323&display=swap" rel="stylesheet">
  <style>
    :root{
      --gold:#e7c76d; --ink:#1a140b; --hud:rgba(0,0,0,.5);
    }
    html,body{height:100%; margin:0; overflow:hidden; background:#0d0e12; color:#f6eeda;}
    body{font-family:'Cinzel', serif}

    /* UI overlay */
    .banner{position:fixed; top:10px; left:50%; transform:translateX(-50%);
      padding:.25rem 1rem; font-family:'UnifrakturMaguntia', cursive; font-size:clamp(26px,6vw,52px);
      background:linear-gradient(180deg,#711c2f,#b82d54); border:3px solid var(--gold); border-radius:10px; z-index:5}

    #hud{position:fixed; left:0; right:0; bottom:10px; display:flex; justify-content:center; gap:10px; z-index:5}
    #hud button{appearance:none; border:2px solid var(--gold); background:var(--hud); color:#fff3d0;
      border-radius:999px; padding:.6rem .9rem; font-family:'VT323', monospace; font-size:20px}
    #hint{position:fixed; bottom:70px; left:50%; transform:translateX(-50%); font:400 14px 'VT323', monospace; color:#f6eeda; opacity:.8; z-index:5}

    /* Lightbox */
    .lightbox{position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; place-items:center; z-index:9}
    .lightbox.on{display:grid}
    .lightbox figure{max-width:min(92vw,900px); max-height:86vh; margin:0; background:#0f0f10; border:6px solid var(--gold); border-radius:12px; box-shadow:0 30px 60px rgba(0,0,0,.6)}
    .lightbox img{display:block; max-width:100%; max-height:72vh}
    .lightbox figcaption{padding:.6rem 1rem; color:#f1e8cf; font:400 16px 'Cinzel',serif; background:linear-gradient(#3a311f,#1f1a12)}
    .navArrow{position:absolute; top:50%; transform:translateY(-50%); width:48px; height:48px; border-radius:50%; border:2px solid var(--gold); color:#f1e8cf; background:rgba(0,0,0,.3); display:grid; place-items:center; font:28px 'VT323', monospace}
    .navArrow.left{left:14px} .navArrow.right{right:14px}
    .closeX{position:absolute; top:12px; right:12px; width:44px; height:44px; border-radius:50%; border:2px solid var(--gold); color:#f1e8cf; background:rgba(0,0,0,.3); display:grid; place-items:center; font:22px 'VT323', monospace}

    /* Loading badge */
    #loading{position:fixed; inset:0; display:grid; place-items:center; color:#fff4d3; font:400 18px 'VT323', monospace; z-index:6; background:radial-gradient(circle at 50% 40%, rgba(255,227,152,.06), transparent 60%)}
    #loading.fade{animation:fadeout .8s forwards}
    @keyframes fadeout{to{opacity:0; visibility:hidden}}
  </style>
</head>
<body>
  <div class="banner">Happy Birthday!</div>
  <div id="loading">Summoning the castle…</div>
  <div id="hint" aria-hidden="true">Tap the doors to enter. Swipe to stroll the hall. Tap frames to view.</div>
  <div id="hud" aria-label="Controls">
    <button id="btnBack">◀ Back</button>
    <button id="btnForward">Forward ▶</button>
  </div>

  <!-- Lightbox overlay for viewing textures in 2D -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <button class="closeX" id="closeX" aria-label="Close">✕</button>
    <button class="navArrow left" id="navL" aria-label="Previous">❮</button>
    <figure>
      <img id="lbImg" alt="Expanded gallery image" />
      <figcaption id="lbCap">&nbsp;</figcaption>
    </figure>
    <button class="navArrow right" id="navR" aria-label="Next">❯</button>
  </div>

  <canvas id="scene"></canvas>

  <!-- Three.js from CDN -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js" type="module"></script>
  <script>
  (()=>{
    // Image list (update paths to your repo assets)
    const gallery = [
      {src:'birthday_center.png', caption:'Birthday Centerpiece'},
      {src:'bunny_room.jpg', caption:'Bunny & Coffee Nook'},
      {src:'cake_room.jpg', caption:'Floral Cake Slice'},
      {src:'tea_room.jpg', caption:'Tea & Croissant'}
    ];

    const canvas = document.getElementById('scene');
    const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0d0e12);

    // Camera
    const camera = new THREE.PerspectiveCamera(60, 2, 0.1, 100);
    camera.position.set(0, 1.6, 8);

    // Lights
    const amb = new THREE.AmbientLight(0x806040, .6); scene.add(amb);
    const dir = new THREE.DirectionalLight(0xfff3cc, .8); dir.position.set(3,5,3); scene.add(dir);

    // Floor & ceiling
    const texLoader = new THREE.TextureLoader();
    const stoneTex = texLoader.load('https://images.unsplash.com/photo-1557683316-973673baf926?auto=format&fit=crop&w=800&q=60');
    stoneTex.wrapS = stoneTex.wrapT = THREE.RepeatWrapping; stoneTex.repeat.set(4,12);
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(10, 60), new THREE.MeshStandardMaterial({map:stoneTex, roughness:.9, metalness:0}));
    floor.rotation.x = -Math.PI/2; floor.position.z = -20; scene.add(floor);
    const ceiling = floor.clone(); ceiling.rotation.x = Math.PI/2; ceiling.position.y = 3.2; scene.add(ceiling);

    // Walls
    const wallMat = new THREE.MeshStandardMaterial({color:0x2a2119, roughness:.95});
    const leftWall = new THREE.Mesh(new THREE.PlaneGeometry(60, 3.2), wallMat);
    leftWall.rotation.y = Math.PI/2; leftWall.position.set(-5, 1.6, -20); scene.add(leftWall);
    const rightWall = leftWall.clone(); rightWall.position.x = 5; rightWall.rotation.y = -Math.PI/2; scene.add(rightWall);

    // 80s neon strip down the hall
    const neonMat = new THREE.MeshBasicMaterial({color:0xe7c76d});
    const neon = new THREE.Mesh(new THREE.PlaneGeometry(0.05, 60), neonMat); neon.position.set(0,0.1,-20); neon.rotation.x=-Math.PI/2; scene.add(neon);

    // Castle door (two wooden leaves)
    const doorGroup = new THREE.Group(); scene.add(doorGroup);
    const wood = new THREE.MeshStandardMaterial({color:0x6b3f1f, roughness:.8, metalness:.2});
    const leafGeo = new THREE.BoxGeometry(1.4, 2.6, 0.08);
    const leftLeaf = new THREE.Mesh(leafGeo, wood); leftLeaf.position.set(-.72,1.3,3.2);
    const rightLeaf = new THREE.Mesh(leafGeo, wood); rightLeaf.position.set(.72,1.3,3.2);
    // hinges (empty groups to rotate around side)
    const leftHinge = new THREE.Group(); leftHinge.position.set(-1.42,1.3,3.2); leftHinge.add(leftLeaf); leftLeaf.position.x = .7;
    const rightHinge = new THREE.Group(); rightHinge.position.set(1.42,1.3,3.2); rightHinge.add(rightLeaf); rightLeaf.position.x = -.7;
    doorGroup.add(leftHinge,rightHinge);

    // Door frame / arch
    const frame = new THREE.Mesh(new THREE.BoxGeometry(3.2, 3.2, 0.2), new THREE.MeshStandardMaterial({color:0x9a8a71, roughness:.9}));
    frame.position.set(0,1.6,3.1); scene.add(frame);

    // Torches with emissive flames
    function torch(x,z){
      const stand = new THREE.Mesh(new THREE.CylinderGeometry(.06,.06,.6,12), new THREE.MeshStandardMaterial({color:0x3b2b17, roughness:1}));
      const fire = new THREE.PointLight(0xffc46a, 1.2, 6); fire.position.set(0,.4,0);
      const group = new THREE.Group(); group.add(stand, fire); group.position.set(x,1.2,z); scene.add(group); return fire;
    }
    torch(-1.8,2.9); torch(1.8,2.9);

    // Frames as textured planes down the hall
    const frames = []; const captions = [];
    const frameGeo = new THREE.PlaneGeometry(2.1, 2.8);
    gallery.forEach((g,i)=>{
      const tex = texLoader.load(g.src);
      tex.colorSpace = THREE.SRGBColorSpace; tex.anisotropy = 8;
      const mat = new THREE.MeshStandardMaterial({map:tex, roughness:.7, metalness:0});
      const mesh = new THREE.Mesh(frameGeo, mat);
      const side = i%2===0? -1 : 1; // Alternate sides
      mesh.position.set( side*4.2, 1.6, -4 - i*6 );
      mesh.rotation.y = side>0? -Math.PI/12 : Math.PI/12;
      scene.add(mesh); frames.push(mesh); captions.push(g.caption);
    });

    // Raycaster for taps on frames
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    function onTap(clientX, clientY){
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((clientX-rect.left)/rect.width)*2 - 1;
      mouse.y = -((clientY-rect.top)/rect.height)*2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const hit = raycaster.intersectObjects(frames)[0];
      if(hit){ openLightbox(frames.indexOf(hit.object)); }
      else if(camera.position.z>2.9){ // if still outside, treat as door tap
        openDoor();
      }
    }

    canvas.addEventListener('pointerdown', e=> onTap(e.clientX, e.clientY));

    // Lightbox handlers (uses DOM overlay)
    const lightbox = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbCap = document.getElementById('lbCap');
    let lbIndex = 0;
    function openLightbox(i){ lbIndex = (i+gallery.length)%gallery.length; lbImg.src = gallery[lbIndex].src; lbCap.textContent = captions[lbIndex]; lightbox.classList.add('on'); }
    function closeLightbox(){ lightbox.classList.remove('on'); }
    document.getElementById('closeX').onclick = closeLightbox;
    document.getElementById('navL').onclick = ()=> openLightbox(lbIndex-1);
    document.getElementById('navR').onclick = ()=> openLightbox(lbIndex+1);

    // Movement controls (forward/back along Z)
    const btnF = document.getElementById('btnForward');
    const btnB = document.getElementById('btnBack');
    btnF.onclick = ()=> moveTargetZ -= 4;
    btnB.onclick = ()=> moveTargetZ += 4;

    let moveTargetZ = camera.position.z; // easing target

    // Door animation then glide camera through
    let doorOpened = false;
    function openDoor(){
      if(doorOpened) return; doorOpened = true;
      let t=0; const dur=1200; const start=performance.now();
      function step(now){
        t = Math.min(1, (now-start)/dur);
        const e = t*t*(3-2*t); // smoothstep
        leftHinge.rotation.y = -e*1.5; rightHinge.rotation.y = e*1.5;
        camera.position.z = 8 - e*4.5; // dolly toward door
        if(t<1) requestAnimationFrame(step); else moveTargetZ = -6; // enter hall
      }
      requestAnimationFrame(step);
      document.getElementById('loading').classList.add('fade');
    }

    // Auto-open door on first tap anywhere or press Forward
    btnForward.addEventListener('click', ()=>{ if(!doorOpened) openDoor(); });

    // Swipe to walk
    let sx=0, dragging=false;
    canvas.addEventListener('touchstart',e=>{dragging=true; sx=e.touches[0].clientX;},{passive:true});
    canvas.addEventListener('touchend',e=>{if(!dragging) return; const dx=e.changedTouches[0].clientX - sx; if(Math.abs(dx)>40){ moveTargetZ += (dx>0? 1:-1)*4; } dragging=false;},{passive:true});

    // Resize
    function resize(){
      const w = window.innerWidth, h = window.innerHeight;
      renderer.setSize(w,h,false);
      camera.aspect = w/h; camera.updateProjectionMatrix();
    }
    window.addEventListener('resize', resize); resize();

    // Animate loop
    const clock = new THREE.Clock();
    function animate(){
      const dt = Math.min(clock.getDelta(), .05);
      // ease camera toward target Z
      camera.position.z += (moveTargetZ - camera.position.z) * Math.min(1, dt*2.5);
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    // First render after textures start loading
    texLoader.manager.onLoad = ()=>{ document.getElementById('loading').classList.add('fade'); };

  })();
  </script>

  <!--
  ===========================
  HOW TO USE ON GITHUB PAGES
  ===========================
  1) Save this as index.html in your repo root.
  2) Create /assets with:
     - assets/birthday_center.png
     - assets/bunny_room.jpg
     - assets/cake_room.jpg
     - assets/tea_room.jpg
  3) Enable Pages (Settings → Pages → Deploy from branch).
  4) Tap the wooden doors to enter. Swipe to walk. Tap any frame to open the lightbox.
  -->
</body>
</html>
